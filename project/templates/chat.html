<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Chat App</title>
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body data-username="{{ username }}" data-user-id="{{ user_id }}">
  <div class="chat-app">

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>💬 Chat</h2>
        </div>

        <!-- Search & Add Friend -->
        <div class="search-box">
            <input type="text" id="search-user" placeholder="Tìm kiếm người dùng..." />
            <ul id="search-results" class="search-results"></ul>
        </div>

        <!-- User & Group list -->
        <ul id="user-list" class="user-list">
            <li class="section-title">📩 Lời mời kết bạn</li>
            <ul id="friend-requests" class="friend-requests"></ul>

            <li data-room="global" class="active">🌍 Phòng chung</li>

            <li class="section-title">👥 Nhóm</li>
            <ul id="groups-list">
                {% for g in groups %}
                    <li data-room="group_{{ g.id }}" data-group-id="{{ g.id }}">👥 {{ g.name }}</li>
                {% endfor %}
            </ul>

            <li class="section-title">👤 Bạn bè</li>
            {% for u in users %}
                <li data-room="user_{{ u.id }}" data-user-id="{{ u.id }}">👤 {{ u.username }}</li>
            {% endfor %}
        </ul>

        <!-- Tạo nhóm mới -->
        <div class="create-group">
            <h4>➕ Tạo nhóm mới</h4>
            <input type="text" id="new-group-name" placeholder="Tên nhóm..." />
            <select id="new-group-member">
                <option value="">Chọn thành viên</option>
                {% for u in users %}
                    <option value="{{ u.id }}">{{ u.username }}</option>
                {% endfor %}
            </select>
            <button id="create-group-btn">Tạo nhóm</button>
        </div>
    </aside>

    <!-- Chat main -->
    <main class="chat-main">
      <div class="chat-header">
        <h3 id="room-title">Phòng chung</h3>
        <a href="/logout" class="logout-btn">Đăng xuất</a>
      </div>

      <div id="chat-box" class="chat-box">
        {% for msg in messages %}
            <div class="msg {% if msg.sender_id == 0 %}system{% elif msg.sender.username == username %}self{% else %}other{% endif %}">
                <div class="bubble">
                    [{{ msg.timestamp | hms_local }}] 
                    <b>{{ msg.sender.username if msg.sender else 'System' }}</b>: {{ msg.content | e }}
                </div>
            </div>
        {% endfor %}
      </div>

      <div class="chat-input">
        <input type="text" id="message" placeholder="Nhập tin nhắn..." />
        <button id="send">➤</button>
      </div>
    </main>

  </div>

  <!-- Socket.IO client -->
  <script src="https://cdn.socket.io/4.7.1/socket.io.min.js"></script>
  <script src="/static/app.js"></script>
</body>
</html>
